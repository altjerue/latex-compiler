#!/bin/bash
# Compilation with latex

# Usage info
show_help() {
cat << EOF
    Usage: ${0##*/} [-bg] [-B BibTeX] [FILE]...

    Do stuff with FILE and write the result to standard output. With no
    FILE or when FILE is -, read standard input.

    -b          display this help and exit
    -B OUTFILE  write the result to OUTFILE instead of standard output.
    -g          verbose mode. Can be used multiple times for increased
                verbosity.
EOF
 }

latexfile="${@: -1:1}"
echo "${(s/./)latexfile}"
l="${latexfile%.*}"
echo $latexfile
echo $l
OPTIND=1

######## LaTeX first run
latex $l

while getopts ":bB:g" opt; do
    case $opt in
        b)
            echo
            echo '*****  Running BibTeX  *****'
            bibtex $l
            ;;
        B)
            echo
            echo '*****  Running BibTeX  *****'
            bibtex ${OPTARG%.*}
            ;;
        g)
            echo
            echo '\n***** Running makeglossaries *****\n'
            makeglossaries phd
            ;;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            exit 1
            ;;
        :)
            echo "Option -$OPTARG requires an argument." >&2
            exit 1
            ;;
        *)
            show_help >&2
            exit 1
            ;;
    esac
done
echo
echo '*****  Running LaTeX again  *****'
latex $l
echo '*****  Running LaTeX again  *****'
latex $l

# Convert to PostScript
echo
echo '*****  Converting DVI to PS  *****'
dvips -Ppdf -z -G0 -j0 $l.dvi -o

# Convert to PDF
echo
echo '*****  Converting PS to PDF  *****'
ps2pdf -sPAPERSIZE=a4 $l.ps

# Deleting log,aux,dvi,out,snm,nav,toc
# rm *.log
# rm *.aux
# rm *.dvi
# rm *.out
# rm *.snm
# rm *.nav
# rm *.toc
